<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Future Link Admin - Master</title>
    <style>
        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background-color: #121212; color: #ffffff; margin: 0; padding: 10px; }
        .header { text-align: center; color: #e74c3c; font-weight: bold; font-size: 22px; margin: 15px 0; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .stat-card { background: #1e272e; padding: 15px 5px; border-radius: 10px; text-align: center; border-bottom: 4px solid #3498db; }
        .stat-card h4 { margin: 0; font-size: 10px; color: #bdc3c7; }
        .stat-card p { margin: 5px 0 0; font-size: 16px; font-weight: bold; }
        .form-section { background: #ffffff; color: #333; padding: 20px; border-radius: 12px; margin-bottom: 20px; }
        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 6px; font-size: 13px; outline: none; }
        input[type="date"] { border: 2px solid #3498db; font-weight: bold; }
        .btn-submit { width: 100%; padding: 15px; background: #27ae60; color: white; border: none; border-radius: 8px; margin-top: 15px; font-weight: bold; font-size: 16px; cursor: pointer; }
        .btn-clear-all { width: 100%; padding: 10px; background: #c0392b; color: white; border: none; border-radius: 8px; margin-top: 10px; font-weight: bold; cursor: pointer; font-size: 14px; }
        .table-container { overflow-x: auto; background: #2c3e50; border-radius: 10px; margin-top: 10px; }
        table { width: 100%; border-collapse: collapse; font-size: 11px; min-width: 600px; }
        th { background: #1a252f; color: #bdc3c7; padding: 12px; text-align: left; }
        td { padding: 12px; border-bottom: 1px solid #34495e; color: #ecf0f1; }
        .action-btns { display: flex; gap: 8px; }
        .btn-del { background: #e74c3c; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; }
        .btn-edit { background: #f1c40f; color: #000; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>

    <div class="header">üë§ Future Link Admin</div>

    <div class="stats-grid">
        <div class="stat-card" style="border-color: #3498db; grid-column: span 2;">
            <h4>‡¶Æ‡ßã‡¶ü ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó</h4><p id="totalLine">0</p>
        </div>
        <div class="stat-card" style="border-color: #f1c40f;"><h4>‡¶Æ‡ßã‡¶ü ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú</h4><p id="totalRecharge">0 ‡ß≥</p></div>
        <div class="stat-card" style="border-color: #2ecc71;"><h4>‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú</h4><p id="totalService">0 ‡ß≥</p></div>
        <div class="stat-card" style="border-color: #e67e22;"><h4>‡¶´‡¶æ‡¶á‡¶¨‡¶æ‡¶∞ ‡¶ñ‡¶∞‡¶ö</h4><p id="totalFiber">0 ‡ß≥</p></div>
        <div class="stat-card" style="border-color: #9b59b6;"><h4>‡¶Ö‡¶®‡ßÅ ‡¶ñ‡¶∞‡¶ö</h4><p id="totalOnu">0 ‡ß≥</p></div>
    </div>

    <div class="form-section">
        <input type="hidden" id="editKey">
        <div class="input-grid">
            <input type="text" id="uName" placeholder="‡¶®‡¶æ‡¶Æ">
            <input type="text" id="uAddress" placeholder="‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ">
            <input type="number" id="uRecharge" placeholder="‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶ü‡¶æ‡¶ï‡¶æ">
            <input type="number" id="uService" placeholder="‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú">
            <input type="number" id="uFiber" placeholder="‡¶´‡¶æ‡¶á‡¶¨‡¶æ‡¶∞ ‡¶ñ‡¶∞‡¶ö">
            <input type="number" id="uOnu" placeholder="‡¶Ö‡¶®‡ßÅ ‡¶ñ‡¶∞‡¶ö">
            <input type="date" id="uDate"> 
        </div>
        <button class="btn-submit" id="saveBtn">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        <button class="btn-clear-all" id="clearAllBtn">üóë ‡¶∏‡¶¨ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>‡¶®‡¶æ‡¶Æ ‡¶ì ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ</th><th>‡¶ö‡¶æ‡¶∞‡ßç‡¶ú (R/S)</th><th>‡¶ñ‡¶∞‡¶ö (F/O)</th><th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th><th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th>
                </tr>
            </thead>
            <tbody id="dataTable"></tbody>
        </table>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onValue, remove, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = { databaseURL: "https://future-link-admin-default-rtdb.firebaseio.com/" };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const dataRef = ref(db, 'future_link_v9');

        document.getElementById('uDate').value = new Date().toISOString().split('T')[0];

        // ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
        document.getElementById('saveBtn').onclick = function() {
            const key = document.getElementById('editKey').value;
            const data = {
                name: document.getElementById('uName').value,
                address: document.getElementById('uAddress').value,
                recharge: parseFloat(document.getElementById('uRecharge').value) || 0,
                service: parseFloat(document.getElementById('uService').value) || 0,
                fiber: parseFloat(document.getElementById('uFiber').value) || 0,
                onu: parseFloat(document.getElementById('uOnu').value) || 0,
                date: document.getElementById('uDate').value
            };

            if(!data.name) return alert("‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶®");

            if(key) {
                update(ref(db, 'future_link_v9/' + key), data).then(() => {
                    alert("‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
                    clearForm();
                });
            } else {
                push(dataRef, data).then(() => clearForm());
            }
        };

        function clearForm() {
            document.getElementById('editKey').value = "";
            document.querySelectorAll('input:not([type="date"])').forEach(i => i.value = "");
            document.getElementById('saveBtn').innerText = "‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®";
            document.getElementById('saveBtn').style.background = "#27ae60";
        }

        document.getElementById('clearAllBtn').onclick = function() {
            if(confirm("‡¶∏‡¶¨ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?")) remove(dataRef);
        };

        // ‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ì ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ ‡¶∏‡¶æ‡¶ú‡¶æ‡¶®‡ßã
        onValue(dataRef, (snapshot) => {
            let html = ""; let sRec = 0, sSer = 0, sFib = 0, sOnu = 0, count = 0;
            let dataArray = [];

            if (snapshot.exists()) {
                snapshot.forEach((child) => {
                    let item = child.val();
                    item.id = child.key;
                    dataArray.push(item);
                });

                // ‡¶®‡¶§‡ßÅ‡¶® ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶â‡¶™‡¶∞‡ßá ‡¶∞‡¶æ‡¶ñ‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
                dataArray.sort((a, b) => new Date(b.date) - new Date(a.date));

                dataArray.forEach((item) => {
                    sRec += item.recharge; sSer += item.service; sFib += item.fiber; sOnu += item.onu; count++;
                    
                    html += `<tr>
                        <td><strong>${item.name}</strong><br><small>${item.address}</small></td>
                        <td>${item.recharge} / ${item.service}</td>
                        <td>${item.fiber} / ${item.onu}</td>
                        <td>${item.date}</td>
                        <td class="action-btns">
                            <button class="btn-edit" onclick="loadEditData('${item.id}')">‚úé</button>
                            <button class="btn-del" onclick="window.delData('${item.id}')">üóë</button>
                        </td>
                    </tr>`;
                });
            }
            document.getElementById('dataTable').innerHTML = html;
            document.getElementById('totalLine').innerText = count;
            document.getElementById('totalRecharge').innerText = sRec + " ‡ß≥";
            document.getElementById('totalService').innerText = sSer + " ‡ß≥";
            document.getElementById('totalFiber').innerText = sFib + " ‡ß≥";
            document.getElementById('totalOnu').innerText = sOnu + " ‡ß≥";
        });

        // ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        window.delData = (id) => { if(confirm("‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?")) remove(ref(db, 'future_link_v9/' + id)); };

        // ‡¶è‡¶°‡¶ø‡¶ü ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶®‡¶§‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶¶ ‡¶™‡¶¶‡ßç‡¶ß‡¶§‡¶ø
        window.loadEditData = (id) => {
            onValue(ref(db, 'future_link_v9/' + id), (snap) => {
                const item = snap.val();
                if(!item) return;
                document.getElementById('editKey').value = id;
                document.getElementById('uName').value = item.name;
                document.getElementById('uAddress').value = item.address;
                document.getElementById('uRecharge').value = item.recharge;
                document.getElementById('uService').value = item.service;
                document.getElementById('uFiber').value = item.fiber;
                document.getElementById('uOnu').value = item.onu;
                document.getElementById('uDate').value = item.date;
                
                document.getElementById('saveBtn').innerText = "‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®";
                document.getElementById('saveBtn').style.background = "#2980b9";
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }, { onlyOnce: true });
        };
    </script>
</body>
</html>
