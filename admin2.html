<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Future Link Admin - Master Final</title>
    <style>
        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background-color: #121212; color: #ffffff; margin: 0; padding: 10px; }
        .header { text-align: center; color: #e74c3c; font-weight: bold; font-size: 22px; margin: 15px 0; }
        
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .stat-card { background: #1e272e; padding: 12px 5px; border-radius: 10px; text-align: center; border-bottom: 4px solid #3498db; cursor: pointer; }
        .stat-card h4 { margin: 0; font-size: 10px; color: #bdc3c7; text-transform: uppercase; }
        .stat-card p { margin: 5px 0 0; font-size: 16px; font-weight: bold; }

        .company-stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 20px; }
        .comp-card { background: #2c3e50; padding: 10px; border-radius: 8px; text-align: center; border-bottom: 3px solid #f1c40f; cursor: pointer; }
        .comp-card h5 { margin: 0; font-size: 9px; color: #f1c40f; }
        .comp-card p { margin: 3px 0 0; font-size: 14px; font-weight: bold; }

        .form-section { background: #ffffff; color: #333; padding: 20px; border-radius: 12px; margin-bottom: 20px; }
        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 6px; font-size: 13px; outline: none; background: white; }
        input[type="date"] { border: 2px solid #3498db; font-weight: bold; }
        
        .quick-amounts { display: flex; gap: 5px; margin-top: 5px; }
        .amt-btn { background: #eee; border: 1px solid #ccc; padding: 5px; border-radius: 4px; font-size: 11px; cursor: pointer; flex: 1; font-weight: bold; text-align: center; color: #333; }

        .btn-submit { width: 100%; padding: 15px; background: #27ae60; color: white; border: none; border-radius: 8px; margin-top: 15px; font-weight: bold; font-size: 16px; cursor: pointer; }
        /* ‡¶Ö‡¶≤ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶¨‡¶æ‡¶ü‡¶® ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
        .btn-delete-all { width: 100%; padding: 10px; background: #c0392b; color: white; border: none; border-radius: 8px; margin-top: 10px; font-weight: bold; font-size: 14px; cursor: pointer; opacity: 0.8; }
        .btn-delete-all:hover { opacity: 1; background: #e74c3c; }
        
        .table-container { overflow-x: auto; background: #2c3e50; border-radius: 10px; margin-top: 10px; }
        table { width: 100%; border-collapse: collapse; font-size: 11px; min-width: 650px; }
        th { background: #1a252f; color: #bdc3c7; padding: 12px; text-align: left; }
        td { padding: 12px; border-bottom: 1px solid #34495e; color: #ecf0f1; }
        .company-tag { color: #f1c40f; font-weight: bold; font-size: 10px; text-transform: uppercase; }
        .btn-del { background: #e74c3c; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; }
        .btn-edit { background: #f1c40f; color: #000; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; margin-right: 5px; }
        
        .filter-badge { text-align: center; margin-bottom: 10px; color: #2ecc71; font-weight: bold; font-size: 14px; }
    </style>
</head>
<body>

    <div class="header">Future Link Admin</div>

    <div class="stats-grid">
        <div class="stat-card" style="border-color: #3498db; grid-column: span 2;" onclick="window.filterByCompany('ALL')">
            <h4>‡¶Æ‡ßã‡¶ü ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó (‡¶∏‡¶¨ ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï)</h4><p id="totalLine">0</p>
        </div>
        <div class="stat-card" style="border-color: #f1c40f;"><h4>‡¶Æ‡ßã‡¶ü ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú</h4><p id="totalRecharge">0 ‡ß≥</p></div>
        <div class="stat-card" style="border-color: #2ecc71;"><h4>‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú</h4><p id="totalService">0 ‡ß≥</p></div>
        <div class="stat-card" style="border-color: #e67e22;"><h4>‡¶´‡¶æ‡¶á‡¶¨‡¶æ‡¶∞ ‡¶ñ‡¶∞‡¶ö</h4><p id="totalFiber">0 ‡ß≥</p></div>
        <div class="stat-card" style="border-color: #9b59b6;"><h4>‡¶Ö‡¶®‡ßÅ ‡¶ñ‡¶∞‡¶ö</h4><p id="totalOnu">0 ‡ß≥</p></div>
    </div>

    <div class="company-stats-grid">
        <div class="comp-card" onclick="window.filterByCompany('HP')"><h5>HP</h5><p id="adminHP">0</p></div>
        <div class="comp-card" onclick="window.filterByCompany('PMTL')"><h5>PMTL</h5><p id="adminPMTL">0</p></div>
        <div class="comp-card" onclick="window.filterByCompany('Orbit')"><h5>ORBIT</h5><p id="adminOrbit">0</p></div>
    </div>

    <div id="filterShow" class="filter-badge"></div>

    <div class="form-section">
        <input type="hidden" id="editKey">
        <input type="hidden" id="editTimestamp">
        <div class="input-grid">
            <select id="uCompany"><option value="HP">HP</option><option value="PMTL">PMTL</option><option value="Orbit">Orbit</option></select>
            <input type="text" id="uName" placeholder="‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ">
            <input type="text" id="uAddress" placeholder="‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ">
            <input type="number" id="uRecharge" placeholder="‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú">
            <div>
                <input type="number" id="uService" placeholder="‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú">
                <div class="quick-amounts">
                    <div class="amt-btn" onclick="document.getElementById('uService').value=200">200</div>
                    <div class="amt-btn" onclick="document.getElementById('uService').value=100">100</div>
                    <div class="amt-btn" onclick="document.getElementById('uService').value=50">50</div>
                    <div class="amt-btn" onclick="document.getElementById('uService').value=0">0</div>
                </div>
            </div>
            <input type="number" id="uFiber" placeholder="‡¶´‡¶æ‡¶á‡¶¨‡¶æ‡¶∞ ‡¶ñ‡¶∞‡¶ö">
            <input type="number" id="uOnu" placeholder="‡¶Ö‡¶®‡ßÅ ‡¶ñ‡¶∞‡¶ö">
            <input type="date" id="uDate"> 
        </div>
        <button class="btn-submit" id="saveBtn">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        <button class="btn-delete-all" onclick="window.deleteAllData()">üóë ‡¶∏‡¶¨ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡ßÅ‡¶®</button>
    </div>

    <div class="table-container">
        <table>
            <thead><tr><th>‡¶ï‡ßã‡¶Æ‡ßç‡¶™‡¶æ‡¶®‡¶ø ‡¶ì ‡¶®‡¶æ‡¶Æ</th><th>‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ</th><th>‡¶ö‡¶æ‡¶∞‡ßç‡¶ú (R/S)</th><th>‡¶ñ‡¶∞‡¶ö (F/O)</th><th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th><th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th></tr></thead>
            <tbody id="dataTable"></tbody>
        </table>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onValue, remove, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = { databaseURL: "https://future-link-admin-default-rtdb.firebaseio.com/" };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const dataRef = ref(db, 'future_link_v9');

        let allRecords = [];
        let currentFilter = 'ALL';

        document.getElementById('uDate').value = new Date().toISOString().split('T')[0];

        window.filterByCompany = function(company) {
            currentFilter = company;
            renderDisplay();
            document.getElementById('filterShow').innerText = company === 'ALL' ? "" : "‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞: " + company;
        };

        function renderDisplay() {
            let html = "";
            let filtered = currentFilter === 'ALL' ? allRecords : allRecords.filter(item => (item.company || "").toLowerCase() === currentFilter.toLowerCase());

            filtered.forEach((item) => {
                html += `<tr>
                    <td><span class="company-tag">${item.company}</span><br><strong>${item.name}</strong></td>
                    <td>${item.address}</td>
                    <td>${item.recharge} / ${item.service}</td>
                    <td>${item.fiber} / ${item.onu}</td>
                    <td>${item.date}</td>
                    <td>
                        <button class="btn-edit" onclick="window.loadEditData('${item.id}')">‚úé</button>
                        <button class="btn-del" onclick="window.delData('${item.id}')">üóë</button>
                    </td>
                </tr>`;
            });
            document.getElementById('dataTable').innerHTML = html;
        }

        onValue(dataRef, (snapshot) => {
            allRecords = [];
            let hp = 0, pmtl = 0, orb = 0;
            let tr = 0, ts = 0, tf = 0, to = 0;

            if (snapshot.exists()) {
                snapshot.forEach((child) => {
                    let val = child.val();
                    val.id = child.key;
                    allRecords.push(val);

                    let c = (val.company || "").toUpperCase();
                    if(c === "HP") hp++; else if(c === "PMTL") pmtl++; else if(c === "ORBIT") orb++;
                    tr += (val.recharge || 0); ts += (val.service || 0);
                    tf += (val.fiber || 0); to += (val.onu || 0);
                });

                allRecords.sort((a, b) => {
                    if (b.date !== a.date) return new Date(b.date) - new Date(a.date);
                    return (b.timestamp || 0) - (a.timestamp || 0);
                });
            }

            renderDisplay();
            document.getElementById('totalLine').innerText = allRecords.length;
            document.getElementById('totalRecharge').innerText = tr + " ‡ß≥";
            document.getElementById('totalService').innerText = ts + " ‡ß≥";
            document.getElementById('totalFiber').innerText = tf + " ‡ß≥";
            document.getElementById('totalOnu').innerText = to + " ‡ß≥";
            document.getElementById('adminHP').innerText = hp;
            document.getElementById('adminPMTL').innerText = pmtl;
            document.getElementById('adminOrbit').innerText = orb;
        });

        document.getElementById('saveBtn').onclick = function() {
            const key = document.getElementById('editKey').value;
            const oldT = document.getElementById('editTimestamp').value;
            const data = {
                company: document.getElementById('uCompany').value,
                name: document.getElementById('uName').value,
                address: document.getElementById('uAddress').value,
                recharge: parseFloat(document.getElementById('uRecharge').value) || 0,
                service: parseFloat(document.getElementById('uService').value) || 0,
                fiber: parseFloat(document.getElementById('uFiber').value) || 0,
                onu: parseFloat(document.getElementById('uOnu').value) || 0,
                date: document.getElementById('uDate').value,
                timestamp: key ? parseInt(oldT) : Date.now()
            };
            if(!data.name) return alert("‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶®");
            if(key) update(ref(db, 'future_link_v9/' + key), data).then(() => clearForm());
            else push(dataRef, data).then(() => clearForm());
        };

        function clearForm() {
            document.getElementById('editKey').value = "";
            document.getElementById('editTimestamp').value = "";
            document.querySelectorAll('input:not([type="date"])').forEach(i => i.value = "");
            document.getElementById('saveBtn').innerText = "‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®";
            document.getElementById('saveBtn').style.background = "#27ae60";
        }

        window.delData = (id) => { if(confirm("‡¶è‡¶á ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?")) remove(ref(db, 'future_link_v9/' + id)); };

        // ‡¶Ö‡¶≤ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        window.deleteAllData = function() {
            if(confirm("‡¶∏‡¶æ‡¶¨‡¶ß‡¶æ‡¶®! ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶Ø‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ‡¶∏‡¶¨ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶ö‡¶ø‡¶∞‡¶§‡¶∞‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶è‡¶ü‡¶ø ‡¶Ü‡¶∞ ‡¶´‡¶ø‡¶∞‡¶ø‡ßü‡ßá ‡¶Ü‡¶®‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§")) {
                remove(dataRef).then(() => {
                    alert("‡¶∏‡¶¨ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§");
                }).catch(err => alert("‡¶≠‡ßÅ‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá: " + err.message));
            }
        };

        window.loadEditData = (id) => {
            onValue(ref(db, 'future_link_v9/' + id), (snap) => {
                const item = snap.val();
                if(!item) return;
                document.getElementById('editKey').value = id;
                document.getElementById('editTimestamp').value = item.timestamp || Date.now();
                document.getElementById('uCompany').value = item.company;
                document.getElementById('uName').value = item.name;
                document.getElementById('uAddress').value = item.address;
                document.getElementById('uRecharge').value = item.recharge;
                document.getElementById('uService').value = item.service;
                document.getElementById('uFiber').value = item.fiber;
                document.getElementById('uOnu').value = item.onu;
                document.getElementById('uDate').value = item.date;
                document.getElementById('saveBtn').innerText = "‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®";
                document.getElementById('saveBtn').style.background = "#2980b9";
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }, { onlyOnce: true });
        };
    </script>
</body>
</html>
